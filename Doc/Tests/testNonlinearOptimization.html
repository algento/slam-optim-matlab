<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of testNonlinearOptimization</title>
  <meta name="keywords" content="testNonlinearOptimization">
  <meta name="description" content="testNonlinearOptimization">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- menu.html Tests -->
<h1>testNonlinearOptimization
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>testNonlinearOptimization</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function testNonlinearOptimization </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> testNonlinearOptimization
 The script applyes nonlinear optimization to a Graph SLAM problem
 The test can be applied to any of the datasets in the ./Data folder 
 '10K', '10KHOGMan','intel','Killian', 'VP'
 The user can choose to either incrementaly optimize the graph or to
 optimize the whole graph at once(batch)
 Author: Viorela Ila</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../Config/addFactor.html" class="code" title="function [Config, System, Graph]=addFactor( factorR,Config, System, Graph)">addFactor</a>	[Config, System, Graph]=addFactor( factorR,Config, System, Graph)</li><li><a href="../Config/initialConfiguration.html" class="code" title="function [Config, System, Graph]=initialConfiguration(Data,Config,System,Graph);">initialConfiguration</a>	</li><li><a href="../Optimization/NonlinearOptimization/nonlinearOptimization.html" class="code" title="function [Config, System]=nonlinearOptimization(Config,System,Graph,Solver,Plot)">nonlinearOptimization</a>	[Config,System]=nonlinearOptimization(Config,System,Graph,Solver,Plot)</li><li><a href="../Utils/Dataset/cut2maxID.html" class="code" title="function [vert, ed]=cut2maxID(maxID,varargin)">cut2maxID</a>	cuts the graph to maxID and add some new set of indexes</li><li><a href="../Utils/Dataset/loadDataSet.html" class="code" title="function [vertices,edges, dataFile]=loadDataSet(dataSet,saveFile)">loadDataSet</a>	[vertices,edges, dataFile]=loadDataSet(dataSet,saveFile)</li><li><a href="../Utils/Plots/PlotConfig.html" class="code" title="function PlotConfig(varargin)">PlotConfig</a>	PlotConfig(varargin)</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function testNonlinearOptimization</a>
0002 
0003 <span class="comment">% testNonlinearOptimization</span>
0004 <span class="comment">% The script applyes nonlinear optimization to a Graph SLAM problem</span>
0005 <span class="comment">% The test can be applied to any of the datasets in the ./Data folder</span>
0006 <span class="comment">% '10K', '10KHOGMan','intel','Killian', 'VP'</span>
0007 <span class="comment">% The user can choose to either incrementaly optimize the graph or to</span>
0008 <span class="comment">% optimize the whole graph at once(batch)</span>
0009 <span class="comment">% Author: Viorela Ila</span>
0010 
0011 close all;
0012 clear all; 
0013 
0014 dataSet=<span class="string">'intel'</span>;
0015 saveFile=1; <span class="comment">% save edges and vertices to a .mat file to speed up the reading when used again.</span>
0016 maxID=0; <span class="comment">% steps to process, if '0', the whole data is processed</span>
0017 
0018 incremental=0; 
0019 
0020 
0021 [vertices,edges]=<a href="../Utils/Dataset/loadDataSet.html" class="code" title="function [vertices,edges, dataFile]=loadDataSet(dataSet,saveFile)">loadDataSet</a>(dataSet,saveFile);
0022 [Data.vert, Data.ed]=<a href="../Utils/Dataset/cut2maxID.html" class="code" title="function [vert, ed]=cut2maxID(maxID,varargin)">cut2maxID</a>(maxID, vertices, edges);
0023 Data.nVert=size(Data.vert,1);
0024 Data.nEd=size(Data.ed,1);
0025 Data.name=dataSet;
0026 
0027 
0028 <span class="comment">% PARAMETERS</span>
0029 
0030 <span class="comment">%Solver</span>
0031 Solver.maxIT=200;
0032 Solver.tol=1e-4;
0033 Solver.linearSolver=<span class="string">'spqr'</span>;
0034 Solver.nonlinearSolver=<span class="string">'GaussNewton'</span>;
0035 Solver.lambda=10;
0036 
0037 <span class="comment">%Plot</span>
0038 <span class="comment">%flags</span>
0039 Plot.InitConfig=0;
0040 Plot.Config=1;
0041 Plot.Error=0;
0042 Plot.DMV=0;
0043 Plot.spyMat=0;
0044 Plot.measurement=1;
0045 
0046 
0047 <span class="comment">%params</span>
0048 Plot.faxis=<span class="string">'off'</span>;
0049 Plot.colour=[0.5,0.5,0.5];
0050 Plot.ftitle=Data.name;
0051 Plot.fname=sprintf(<span class="string">'%s_'</span>,Data.name);
0052 
0053 
0054 <span class="comment">%CONFIG</span>
0055 
0056 Config.p0 = Data.vert(1,2:end)'; <span class="comment">% prior</span>
0057 Config.s0 = diag([Data.ed(1,6),Data.ed(1,8),Data.ed(1,9)]); <span class="comment">% noise on prior</span>
0058 Config.LandDim=2;   <span class="comment">% landmark size</span>
0059 Config.PoseDim=3;   <span class="comment">% pose size</span>
0060 Config.ndx=0;       <span class="comment">% config index</span>
0061 Config.nPoses=0;    <span class="comment">% number of poses</span>
0062 Config.nLands=0;    <span class="comment">% number of landmarks</span>
0063 Config.id2config=zeros(Data.nVert,2); <span class="comment">% variable id to position in the config vector converter</span>
0064 Config.id2config(Data.vert(1,1)+1,:)=[Config.nPoses,Config.nLands];
0065 Config.vector=[Config.p0,[1,1,1]']; <span class="comment">% the second column is used for rapid identification of the landmark=0 vs pose=1</span>
0066 Config.size=size(Config.vector,1);
0067 
0068 <span class="comment">%SYSTEM</span>
0069 
0070 System.ndx=1:Config.PoseDim;
0071 R0=chol(inv(Config.s0));
0072 System.A(System.ndx,System.ndx)=sparse(R0); <span class="comment">% Given noise in the 1st pose</span>
0073 System.b(System.ndx,1)=zeros(Config.PoseDim,1); <span class="comment">% the pose will not be updated</span>
0074 
0075 
0076 <span class="comment">% GRAPH</span>
0077 <span class="comment">% factors</span>
0078 Graph.F=[]; <span class="comment">% keeps the factors</span>
0079 <span class="comment">%variables</span>
0080 Graph.idX=Data.vert(1,1); <span class="comment">% the id in the variables in the graph</span>
0081 
0082 <span class="keyword">if</span> ~incremental    
0083     
0084     <span class="comment">% Build the system and initial configuration</span>
0085     [Config, System, Graph]=<a href="../Config/initialConfiguration.html" class="code" title="function [Config, System, Graph]=initialConfiguration(Data,Config,System,Graph);">initialConfiguration</a>(Data,Config,System,Graph);
0086    
0087     <span class="comment">% plot initial config</span>
0088     <span class="keyword">if</span> Plot.InitConfig
0089         <a href="../Utils/Plots/PlotConfig.html" class="code" title="function PlotConfig(varargin)">PlotConfig</a>(Plot,Config,Graph,<span class="string">'g'</span>,<span class="string">'y'</span>);
0090     <span class="keyword">end</span>
0091     
0092     <span class="comment">% OPTIMIZE</span>
0093     [Config, System]=<a href="../Optimization/NonlinearOptimization/nonlinearOptimization.html" class="code" title="function [Config, System]=nonlinearOptimization(Config,System,Graph,Solver,Plot)">nonlinearOptimization</a>(Config,System,Graph,Solver,Plot); 
0094     
0095 <span class="keyword">else</span>
0096     ind=1;
0097     <span class="keyword">while</span> ind&lt;=Data.nEd
0098         factorR=Data.ed(ind,:);
0099         [Config, System, Graph]=<a href="../Config/addFactor.html" class="code" title="function [Config, System, Graph]=addFactor( factorR,Config, System, Graph)">addFactor</a>(factorR,Config, System, Graph);
0100         [Config, System]=<a href="../Optimization/NonlinearOptimization/nonlinearOptimization.html" class="code" title="function [Config, System]=nonlinearOptimization(Config,System,Graph,Solver,Plot)">nonlinearOptimization</a>(Config,System,Graph,Solver,Plot); 
0101         ind=ind+1;
0102         
0103     <span class="keyword">end</span>
0104 <span class="keyword">end</span>
0105     
0106 
0107 <span class="comment">% plot final config and errors</span>
0108 <a href="../Utils/Plots/PlotConfig.html" class="code" title="function PlotConfig(varargin)">PlotConfig</a>(Plot,Config,Graph,<span class="string">'r'</span>,<span class="string">'b'</span>);
0109 
0110 <span class="keyword">if</span> Plot.DMV
0111     figure
0112     plot(Config.dmv)
0113     title(<span class="string">'DMV'</span>);
0114 <span class="keyword">end</span>
0115 <span class="keyword">if</span> Plot.Error
0116     figure
0117     plot(Config.all_error)
0118     title(<span class="string">'Error'</span>);
0119     
0120 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 11-May-2011 19:51:36 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>